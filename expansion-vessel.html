<!doctype html><html lang="en"><head>  <meta charset="utf-8" />  <meta name="viewport" content="width=device-width,initial-scale=1" />  <title>Expansion Vessel Sizing (CIBSE Method – Unit 307)</title>  <style>    :root { font-family: system-ui, Arial, sans-serif; line-height: 1.35; }    body { margin: 0; background: #f6f7fb; }    .wrap { max-width: 980px; margin: 24px auto; padding: 0 16px; }    .card { background: #fff; border-radius: 14px; padding: 18px; box-shadow: 0 6px 20px rgba(0,0,0,.06); }    h1 { font-size: 1.25rem; margin: 0 0 10px; }    h2 { font-size: 1.05rem; margin: 18px 0 8px; }    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }    .col6 { grid-column: span 6; }    .col4 { grid-column: span 4; }    .col3 { grid-column: span 3; }    .col12 { grid-column: span 12; }    label { display:block; font-size: .88rem; margin: 0 0 6px; color:#2b2f39; }    input { width: 100%; padding: 10px 10px; border: 1px solid #d6dae5; border-radius: 10px; font-size: 1rem; background:#fff; }    .muted { color:#5b6272; font-size: .9rem; }    .row { display:flex; gap: 10px; align-items: center; flex-wrap: wrap; }    button { padding: 10px 14px; border: 0; border-radius: 10px; font-weight: 600; cursor:pointer; }    .primary { background:#1f6feb; color:#fff; }    .ghost { background:#eef2ff; }    .out { background:#0b1220; color:#e9eefc; border-radius: 12px; padding: 14px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: pre-wrap; }    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#eef2ff; font-size:.82rem; }    .warn { color:#7a4b00; background:#fff7e6; border:1px solid #ffe1a6; padding:10px; border-radius:10px; }    .ok { color:#0b4; background:#eafff1; border:1px solid #b9f6cf; padding:10px; border-radius:10px; }    @media (max-width: 760px){ .col6,.col4,.col3{ grid-column: span 12; } }  </style></head><body>  <div class="wrap">    <div class="card">      <h1>Expansion Vessel Sizing (CIBSE method – Unit 307)</h1>      <p class="muted">        Uses: <span class="pill">e = (d1 − d2) / d2</span>        and <span class="pill">V = eC / (1 − P1/P2)</span>.        Pressures use absolute values: <span class="pill">P(abs) = P(gauge) + 1</span>.      </p>      <div class="grid">        <div class="col6">          <label>Total system water volume, C (litres)</label>          <input id="C" type="number" min="0" step="0.1" value="600">        </div>        <div class="col3">          <label>Fill pressure (bar gauge)</label>          <input id="fillGauge" type="number" min="0" step="0.1" value="1.5">        </div>        <div class="col3">          <label>PRV setting (bar gauge)</label>          <input id="prvGauge" type="number" min="0" step="0.1" value="6">        </div>        <div class="col6">          <h2>Option A: enter temperatures (auto density lookup)</h2>          <label>Fill water temperature (°C)</label>          <input id="tFill" type="number" min="0" max="100" step="0.1" value="10">          <label style="margin-top:10px;">Max operating temperature (°C)</label>          <input id="tHot" type="number" min="0" max="100" step="0.1" value="80">          <div class="ok" style="margin-top:10px;">            The app will <b>snap</b> your temperature to the nearest value in the density table.          </div>        </div>        <div class="col6">          <h2>Option B: manual densities (overrides temperatures)</h2>          <label>Density at fill temp, d1 (kg/m³)</label>          <input id="d1" type="number" step="0.1" placeholder="Leave blank to use temp lookup">          <label style="margin-top:10px;">Density at operating temp, d2 (kg/m³)</label>          <input id="d2" type="number" step="0.1" placeholder="Leave blank to use temp lookup">          <div class="warn" style="margin-top:10px;">            If you type BOTH d1 and d2, the app will use them (even if temps are filled in).          </div>        </div>        <div class="col12">          <div class="row" style="margin-top:6px;">            <button class="primary" id="calcBtn">Calculate</button>            <button class="ghost" id="clearDens">Clear manual densities</button>            <button class="ghost" id="loadExample">Load handout example</button>            <span class="muted">Shows full working + final vessel volume V (litres).</span>          </div>        </div>        <div class="col12">          <h2>Results</h2>          <div class="out" id="out">Press Calculate…</div>        </div>      </div>    </div>  </div><script>  /**   * Density table (kg/m³) - teaching values commonly used for expansion vessel sizing.   * If your handout table has different points, you can edit/extend this list.   */  const densityByTempC = new Map([    [0.01, 999.8],    [4, 1000.0],    [5, 999.9],    [10, 999.8],    [15, 999.2],    [20, 998.3],    [25, 997.1],    [30, 995.7],    [35, 994.1],    [40, 992.3],    [45, 990.2],    [50, 988.0],    [55, 986.0],    [60, 983.0],    [65, 980.0],    [70, 978.0],    [75, 975.0],    [80, 972.0],    [85, 968.0],    [90, 965.0],    [95, 962.0],    [100, 958.0],  ]);  const temps = Array.from(densityByTempC.keys()).sort((a,b)=>a-b);  function nearestDensity(tempC) {    let bestT = temps[0];    let bestDiff = Math.abs(tempC - bestT);    for (const t of temps) {      const diff = Math.abs(tempC - t);      if (diff < bestDiff) { bestDiff = diff; bestT = t; }    }    return { tableTemp: bestT, density: densityByTempC.get(bestT) };  }  function fmt(n, dp=4) {    if (!Number.isFinite(n)) return "—";    return n.toFixed(dp);  }  function readNumber(id) {    const el = document.getElementById(id);    const raw = (el.value ?? "").toString().trim();    if (raw === "") return { value: NaN, raw };    const v = Number(raw);    return { value: v, raw };  }  function calculate() {    const C = readNumber('C').value;    const fillGauge = readNumber('fillGauge').value;    const prvGauge  = readNumber('prvGauge').value;    // Absolute pressures per handout: P(abs) = P(g) + 1 bar    const P1 = fillGauge + 1;    const P2 = prvGauge + 1;    // Temps (Option A)    const tFill = readNumber('tFill').value;    const tHot  = readNumber('tHot').value;    // Manual densities (Option B) - ONLY used if both are provided    const d1Field = readNumber('d1');    const d2Field = readNumber('d2');    const manualOn = (d1Field.raw !== "" && d2Field.raw !== "" && Number.isFinite(d1Field.value) && Number.isFinite(d2Field.value));    // Determine d1/d2    const d1A = nearestDensity(tFill);    const d2A = nearestDensity(tHot);    const d1 = manualOn ? d1Field.value : d1A.density;    const d2 = manualOn ? d2Field.value : d2A.density;    // Validation    const issues = [];    if (!(Number.isFinite(C) && C > 0)) issues.push("C must be > 0 litres.");    if (!(Number.isFinite(fillGauge) && fillGauge >= 0)) issues.push("Fill pressure must be ≥ 0 bar(g).");    if (!(Number.isFinite(prvGauge) && prvGauge > 0)) issues.push("PRV setting must be > 0 bar(g).");    if (!(P2 > P1)) issues.push("P2 must be greater than P1 (PRV setting must exceed fill pressure).");    if (!(Number.isFinite(d1) && d1 > 0 && Number.isFinite(d2) && d2 > 0)) issues.push("Densities must be valid and > 0.");    if (!(d1 > d2)) issues.push("d1 should be greater than d2 (water density reduces as temperature rises). Check inputs.");    if (issues.length) {      document.getElementById('out').textContent = "Fix these inputs:\n- " + issues.join("\n- ");      return;    }    // Step 1: expansion factor e    // e = (d1 - d2) / d2    const e = (d1 - d2) / d2;    // Step 2: expanded volume of water    // eC    const eC = e * C;    // Step 3: vessel volume (handout method)    // V = eC / (1 - P1/P2)    const denom = (1 - (P1 / P2));    const V = eC / denom;    const modeText = manualOn      ? `Using Option B (manual densities).`      : `Using Option A (temp lookup snapped to table): d1@${d1A.tableTemp}°C, d2@${d2A.tableTemp}°C.`;    const densityLine = manualOn      ? `- d1 used = ${d1} kg/m³\n- d2 used = ${d2} kg/m³`      : `- Fill temp entered = ${tFill} °C → snapped to ${d1A.tableTemp} °C (d1 = ${d1A.density} kg/m³)\n- Hot temp entered  = ${tHot} °C → snapped to ${d2A.tableTemp} °C (d2 = ${d2A.density} kg/m³)`;    document.getElementById('out').textContent =`Mode: ${modeText}Inputs- C (system volume) = ${C} L- Fill pressure (gauge) = ${fillGauge} bar  →  P1 (absolute) = ${P1} bar abs- PRV setting (gauge)  = ${prvGauge} bar   →  P2 (absolute) = ${P2} bar abs${densityLine}Step 1: Expansion factore = (d1 − d2) / d2e = (${d1} − ${d2}) / ${d2} = ${fmt(e, 6)}  (${fmt(e * 100, 2)}%)Step 2: Expanded volume of watereC = ${fmt(e, 6)} × ${C} = ${fmt(eC, 3)} LStep 3: Vessel volume (CIBSE method – handout)V = eC / (1 − P1/P2)Denominator = 1 − ${P1}/${P2} = ${fmt(denom, 6)}RESULTV = ${fmt(V, 2)} L`;  }  // UI wiring  document.getElementById('calcBtn').addEventListener('click', calculate);  document.getElementById('clearDens').addEventListener('click', () => {    document.getElementById('d1').value = "";    document.getElementById('d2').value = "";    calculate();  });  // Handout example (typical):  // C = 600 L, fill = 1.5 bar(g) -> P1=2.5 abs, PRV=6 bar(g) -> P2=7 abs,  // d1 @10°C = 999.8, d2 @80°C = 972  document.getElementById('loadExample').addEventListener('click', () => {    document.getElementById('C').value = 600;    document.getElementById('fillGauge').value = 1.5;    document.getElementById('prvGauge').value = 6;    document.getElementById('tFill').value = 10;    document.getElementById('tHot').value = 80;    document.getElementById('d1').value = "";    document.getElementById('d2').value = "";    calculate();  });  // Auto-calc on input change (nice for teaching)  const inputs = ['C','fillGauge','prvGauge','tFill','tHot','d1','d2'];  for (const id of inputs) {    document.getElementById(id).addEventListener('input', () => {      // Small debounce feel without timers: just compute immediately      calculate();    });  }  // Initial run  calculate();</script></body></html>